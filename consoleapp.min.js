function ConsoleApp(b){var a=this;if(!(a instanceof ConsoleApp))return new ConsoleApp(b);b=b||{};b.backgroundColor||(b.backgroundColor="black");b.textStyle||(b.textStyle="color: #d0d0d0;");b.inputTextStyle||(b.inputTextStyle="color: white;");b.errorTextStyle||(b.errorTextStyle="color: #e80000;");b.fontSize||(b.fontSize=18);void 0===b.prompt&&(b.prompt="> ");var n=document.getElementsByTagName("head")[0],p=document.createElement("style");p.type="text/css";p.innerHTML=["html, body {\nmargin: 0; padding: 0;\nwidth: 100%; height: 100%;\ndisplay: flex;",
b.textStyle,"}\n#main_container, #editor_container { overflow-y: auto; }\n#input, #editor, #main_container, #editor_container { flex-grow: 1; }\nbody, #input, #editor { font-family: 'Consolas', 'Lucida Console', monospace; }\n#output, #input_container, #input, #editor {\nborder: 0; padding: 0; margin: 0; outline: 0;","font-size: "+b.fontSize+"px;","white-space: pre;\n}","#input, #editor { "+b.inputTextStyle+" }","#input_container { display: flex; flex-basis: 2em; }","html, body, #input, #editor { background-color: "+
b.backgroundColor+"; }","#main_container, #editor { padding: 1em; }\n#editor_container { display: flex; }\n#editor { resize: none; }\n.hidden { display: none !important; }"].join("\n");n.appendChild(p);n=document.getElementsByTagName("body")[0];var e=document.createElement("div"),h=document.createElement("div"),d=document.createElement("input"),f=document.createElement("label"),k=document.createElement("pre"),m=document.createElement("div"),g=document.createElement("textarea");e.id="main_container";
h.id="input_container";k.id="output";n.appendChild(e);e.appendChild(k);e.appendChild(h);h.appendChild(f);h.appendChild(d);f.htmlFor=d.id="input";d.spellcheck=!1;n.appendChild(m);m.appendChild(g);m.id="editor_container";g.id="editor";g.value=b.editorText||"";g.spellcheck=!1;e.onclick=function(){a.selection()||d.focus()};d.addEventListener("keydown",function(c){if(13===c.keyCode){try{a.print(b.prompt),a.println(d.value,b.inputTextStyle),a.onCommand(d.value)}catch(l){a.onError(l)}d.value="";e.scrollTop=
e.scrollHeight;c.preventDefault();return!1}});document.addEventListener("keydown",function(c){var l=String.fromCharCode(c.which).toLowerCase();if((c.ctrlKey||c.metaKey)&&("r"===l||"e"===l))return"r"===l&&"edit"===a.currentMode?a.consoleMode():b.editable&&"e"===l&&"console"===a.currentMode&&a.editMode(),c.preventDefault(),!1});a.selection=function(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:
""};a.editorText=function(a){void 0!==a&&(g.value=a);return g.value};a.onCommand=b.onCommand||function(a){a.onError("No onCommand handler registered.")};a.onError=b.onError||function(c){a.println(c.toString(),b.errorTextStyle)};a.onConsoleMode=b.onConsoleMode;a.onEditMode=b.onEditMode;a.consoleMode=function(){try{if(a.currentMode="console",m.className="hidden",e.className="",a.enable(),a.onConsoleMode)a.onConsoleMode()}catch(c){a.onError(c)}};a.editMode=function(){try{if(a.currentMode="edit",e.className=
"hidden",m.className="",g.focus(),a.onEditMode)a.onEditMode()}catch(c){a.onError(c)}};a.enable=function(){h.className="";d.disabled=!1;d.focus()};a.disable=function(){h.className="hidden";d.disabled=!0};a.print=function(a,b){var c=document.createElement("span");c.appendChild(document.createTextNode(a));b&&(c.style=b);k.appendChild(c)};a.println=function(b,d){a.print(b+"\n",d)};a.clear=function(){for(;k.firstChild;)k.removeChild(k.firstChild)};a.setPrompt=function(a,d){for(;f.firstChild;)f.removeChild(f.firstChild);
b.prompt=a;f.appendChild(document.createTextNode(a));d&&(f.style=d)};a.consoleMode();a.setPrompt(b.prompt)};