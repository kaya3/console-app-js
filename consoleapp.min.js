function ConsoleApp(b){var a=this;if(!(a instanceof ConsoleApp))return new ConsoleApp(b);b=b||{};b.backgroundColor||(b.backgroundColor="black");b.textStyle||(b.textStyle="font-size: 18px; color: #d0d0d0;");b.inputTextStyle||(b.inputTextStyle="color: white;");b.errorTextStyle||(b.errorTextStyle="color: #e80000;");b.fontSize||(b.fontSize=18);void 0===b.prompt&&(b.prompt="> ");var n=document.getElementsByTagName("head")[0],p=document.createElement("style");p.type="text/css";p.innerHTML=["html, body {\nmargin: 0; padding: 0;\nwidth: 100%; height: 100%;\ndisplay: flex;",
b.textStyle,"}\n#main_container, #editor_container { overflow-y: auto; }\n#input, #editor, #main_container, #editor_container { flex-grow: 1; }\nbody, #input, #editor { font-family: 'Consolas', 'Lucida Console', monospace; }\n#output, #input_container, #input, #editor {\nborder: 0; padding: 0; margin: 0; outline: 0;","font-size: "+b.fontSize+"px;","white-space: pre;\n}","#input, #editor { "+b.inputTextStyle+" }","#input_container { display: flex; flex-basis: 2em; }","html, body, #input, #editor { background-color: "+
b.backgroundColor+"; }","#main_container, #editor { padding: 1em; }\n#editor_container { display: flex; }\n#editor { resize: none; }\n.hidden { display: none !important; }"].join("\n");n.appendChild(p);n=document.getElementsByTagName("body")[0];var f=document.createElement("div"),k=document.createElement("div"),e=document.createElement("input"),g=document.createElement("label"),l=document.createElement("pre"),m=document.createElement("div"),h=document.createElement("textarea");f.id="main_container";
k.id="input_container";l.id="output";n.appendChild(f);f.appendChild(l);f.appendChild(k);k.appendChild(g);k.appendChild(e);g.htmlFor=e.id="input";e.spellcheck=!1;n.appendChild(m);m.appendChild(h);m.id="editor_container";h.id="editor";h.value=b.editorText||"";h.spellcheck=!1;f.onclick=function(){a.selection()||e.focus()};e.addEventListener("keydown",function(c){if(13===c.keyCode){try{a.print(b.prompt),a.println(e.value,b.inputTextStyle),a.onCommand(e.value)}catch(d){a.onError(d)}e.value="";f.scrollTop=
f.scrollHeight;c.preventDefault();return!1}});window.addEventListener("keydown",function(c){if(c.ctrlKey||c.metaKey){var d=String.fromCharCode(c.which).toLowerCase();"r"===d?a.consoleMode():"e"===d&&b.editable&&a.editMode();c.preventDefault();return!1}});a.selection=function(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:""};a.editorText=function(a){void 0!==a&&(h.value=a);return h.value};a.onCommand=
b.onCommand||function(a){a.onError("No onCommand handler registered.")};a.onError=b.onError||function(c){a.println(c.toString(),b.errorTextStyle)};a.consoleMode=function(b){try{if(m.className="hidden",f.className="",a.enable(),a.onConsoleMode)a.onConsoleMode()}catch(d){a.onError(d)}};a.editMode=function(b){try{if(f.className="hidden",m.className="",h.focus(),a.onEditMode)a.onEditMode()}catch(d){a.onError(d)}};a.enable=function(){k.className="";e.disabled=!1;e.focus()};a.disable=function(){k.className=
"hidden";e.disabled=!0};a.print=function(a,b){var c=document.createElement("span");c.appendChild(document.createTextNode(a));b&&(c.style=b);l.appendChild(c)};a.println=function(b,d){a.print(b+"\n",d)};a.clear=function(){for(;l.firstChild;)l.removeChild(l.firstChild)};a.setPrompt=function(a,d){for(;g.firstChild;)g.removeChild(g.firstChild);b.prompt=a;g.appendChild(document.createTextNode(a));d&&(g.style=d)};a.consoleMode();a.setPrompt(b.prompt)};