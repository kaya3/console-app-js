function ConsoleApp(b){var a=this;if(!(a instanceof ConsoleApp))return new ConsoleApp(b);b=b||{};b.backgroundColor||(b.backgroundColor="black");b.textStyle||(b.textStyle="color: #d0d0d0;");b.inputTextStyle||(b.inputTextStyle="color: white;");b.errorTextStyle||(b.errorTextStyle="color: #e80000;");b.fontSize||(b.fontSize=18);void 0===b.prompt&&(b.prompt="> ");var m=document.getElementsByTagName("head")[0],p=document.createElement("style");p.type="text/css";p.innerHTML=["html, body {\nmargin: 0; padding: 0;\nwidth: 100%; height: 100%;\ndisplay: flex;",
b.textStyle,"}\n#main_container, #editor_container { overflow-y: auto; }\n#input, #editor, #main_container, #editor_container { flex-grow: 1; }\nbody, #input, #editor { font-family: 'Consolas', 'Lucida Console', monospace; }\n#output, #input_container, #input, #editor {\nborder: 0; padding: 0; margin: 0; outline: 0;","font-size: "+b.fontSize+"px;","white-space: pre;\n}","#input, #editor { "+b.inputTextStyle+" }","#input_container { display: flex; flex-basis: 2em; }","html, body, #input, #editor { background-color: "+
b.backgroundColor+"; }","#main_container, #editor { padding: 1em; }\n#editor_container { display: flex; }\n#editor { resize: none; }\n.hidden { display: none !important; }"].join("\n");m.appendChild(p);m=document.getElementsByTagName("body")[0];var e=document.createElement("div"),h=document.createElement("div"),c=document.createElement("input"),f=document.createElement("label"),k=document.createElement("pre"),l=document.createElement("div"),g=document.createElement("textarea");e.id="main_container";
h.id="input_container";k.id="output";m.appendChild(e);e.appendChild(k);e.appendChild(h);h.appendChild(f);h.appendChild(c);f.htmlFor=c.id="input";c.spellcheck=!1;m.appendChild(l);l.appendChild(g);l.id="editor_container";g.id="editor";g.value=b.editorText||"";g.spellcheck=!1;e.onclick=function(){a.selection()||c.focus()};c.addEventListener("keydown",function(d){var n=String.fromCharCode(d.which).toLowerCase();if(13===d.keyCode){try{a.print(b.prompt),a.println(c.value,b.inputTextStyle),a.onCommand(c.value)}catch(q){a.onError(q)}c.value=
"";e.scrollTop=e.scrollHeight;d.preventDefault();return!1}if(b.editable&&(d.ctrlKey||d.metaKey)&&("r"===n||"e"===n))return"r"===n&&"edit"===a.currentMode?a.consoleMode():"e"===n&&"console"===a.currentMode&&a.editMode(),d.preventDefault(),!1});a.selection=function(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:""};a.editorText=function(a){void 0!==a&&(g.value=a);return g.value};a.onCommand=b.onCommand||
function(a){a.onError("No onCommand handler registered.")};a.onError=b.onError||function(d){a.println(d.toString(),b.errorTextStyle)};a.onConsoleMode=b.onConsoleMode;a.onEditMode=b.onEditMode;a.consoleMode=function(){try{if(a.currentMode="console",l.className="hidden",e.className="",a.enable(),a.onConsoleMode)a.onConsoleMode()}catch(d){a.onError(d)}};a.editMode=function(){try{if(a.currentMode="edit",e.className="hidden",l.className="",g.focus(),a.onEditMode)a.onEditMode()}catch(d){a.onError(d)}};
a.enable=function(){h.className="";c.disabled=!1;c.focus()};a.disable=function(){h.className="hidden";c.disabled=!0};a.print=function(a,b){var d=document.createElement("span");d.appendChild(document.createTextNode(a));b&&(d.style=b);k.appendChild(d)};a.println=function(b,c){a.print(b+"\n",c)};a.clear=function(){for(;k.firstChild;)k.removeChild(k.firstChild)};a.setPrompt=function(a,c){for(;f.firstChild;)f.removeChild(f.firstChild);b.prompt=a;f.appendChild(document.createTextNode(a));c&&(f.style=c)};
a.consoleMode();a.setPrompt(b.prompt)};